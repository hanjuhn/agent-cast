# Gmail API ì„¤ì • ê°€ì´ë“œ

Gmail MCPë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ Gmail ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ Google Cloud Consoleì—ì„œ Gmail APIë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

## 1. Google Cloud Console ì„¤ì •

### 1.1 í”„ë¡œì íŠ¸ ìƒì„±
1. [Google Cloud Console](https://console.cloud.google.com/)ì— ì ‘ì†
2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ë˜ëŠ” ê¸°ì¡´ í”„ë¡œì íŠ¸ ì„ íƒ
3. í”„ë¡œì íŠ¸ ì´ë¦„ì„ `agent-cast-gmail` ë“±ìœ¼ë¡œ ì„¤ì •

### 1.2 Gmail API í™œì„±í™”
1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "API ë° ì„œë¹„ìŠ¤" > "ë¼ì´ë¸ŒëŸ¬ë¦¬" ì„ íƒ
2. "Gmail API" ê²€ìƒ‰ í›„ ì„ íƒ
3. "ì‚¬ìš©" ë²„íŠ¼ í´ë¦­í•˜ì—¬ API í™œì„±í™”

### 1.3 OAuth ë™ì˜ í™”ë©´ ì„¤ì • âš ï¸ **í•„ìˆ˜!**
**ì´ ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ë©´ 403 access_denied ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.**

1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "API ë° ì„œë¹„ìŠ¤" > "OAuth ë™ì˜ í™”ë©´" ì„ íƒ
2. ì‚¬ìš©ì ìœ í˜• ì„ íƒ:
   - **ì™¸ë¶€**: ê°œì¸ Gmail ê³„ì • ì‚¬ìš© ì‹œ (ê¶Œì¥)
   - **ë‚´ë¶€**: Google Workspace ì¡°ì§ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš© ì‹œ
3. "ë§Œë“¤ê¸°" í´ë¦­

#### ğŸ“ OAuth ë™ì˜ í™”ë©´ ì •ë³´ ì…ë ¥:
- **ì•± ì´ë¦„**: `Agent Cast Gmail Integration`
- **ì‚¬ìš©ì ì§€ì› ì´ë©”ì¼**: ë³¸ì¸ì˜ Gmail ì£¼ì†Œ
- **ì•± ë„ë©”ì¸** (ì„ íƒì‚¬í•­): ë¹„ì›Œë‘˜ ìˆ˜ ìˆìŒ
- **ìŠ¹ì¸ëœ ë„ë©”ì¸** (ì„ íƒì‚¬í•­): ë¹„ì›Œë‘˜ ìˆ˜ ìˆìŒ
- **ê°œë°œì ì—°ë½ì²˜ ì •ë³´**: ë³¸ì¸ì˜ Gmail ì£¼ì†Œ
- "ì €ì¥ í›„ ê³„ì†" í´ë¦­

#### ğŸ”’ ë²”ìœ„(Scopes) ì„¤ì •:
1. "ë²”ìœ„ ì¶”ê°€ ë˜ëŠ” ì‚­ì œ" í´ë¦­
2. "Gmail API" ê²€ìƒ‰
3. `https://www.googleapis.com/auth/gmail.readonly` ë²”ìœ„ ì„ íƒ
4. "ì—…ë°ì´íŠ¸" í´ë¦­
5. "ì €ì¥ í›„ ê³„ì†" í´ë¦­

#### ğŸ‘¥ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì¶”ê°€ (ê°€ì¥ ì¤‘ìš”!):
1. "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì¶”ê°€" í´ë¦­
2. **ë³¸ì¸ì˜ Gmail ì£¼ì†Œ** ì…ë ¥ (ê¼­ ì¶”ê°€í•´ì•¼ í•¨!)
3. "ì¶”ê°€" í´ë¦­
4. "ì €ì¥ í›„ ê³„ì†" í´ë¦­

### 1.4 OAuth 2.0 ì¸ì¦ ì •ë³´ ìƒì„±
1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "API ë° ì„œë¹„ìŠ¤" > "ì‚¬ìš©ì ì¸ì¦ ì •ë³´" ì„ íƒ
2. "ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°" > "OAuth í´ë¼ì´ì–¸íŠ¸ ID" ì„ íƒ
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•: "ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜" ì„ íƒ
4. ì´ë¦„: `Gmail MCP Client` ë“±ìœ¼ë¡œ ì„¤ì •
5. "ë§Œë“¤ê¸°" í´ë¦­

### 1.5 ì¸ì¦ ì •ë³´ ë‹¤ìš´ë¡œë“œ
1. ìƒì„±ëœ OAuth í´ë¼ì´ì–¸íŠ¸ ID ì˜†ì˜ ë‹¤ìš´ë¡œë“œ ì•„ì´ì½˜ í´ë¦­
2. JSON íŒŒì¼ì„ `credentials.json` ì´ë¦„ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ì €ì¥

## 2. í™˜ê²½ ì„¤ì •

### 2.1 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
`.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€:

```env
# Gmail MCP
GMAIL_CREDENTIALS_FILE=credentials.json
GMAIL_TOKEN_FILE=token.json
GMAIL_USER_ID=me
```

### 2.2 ì˜ì¡´ì„± ì„¤ì¹˜
```bash
pip install -r requirements.txt
```

## 3. ì²« ì‹¤í–‰ ë° ì¸ì¦

### 3.1 í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
python test_gmail_integration.py
```

### 3.2 ì¸ì¦ ê³¼ì •
1. ì²« ì‹¤í–‰ ì‹œ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì—´ë¦¼
2. Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
3. Gmail ì½ê¸° ê¶Œí•œ í—ˆìš©
4. ì¸ì¦ì´ ì™„ë£Œë˜ë©´ `token.json` íŒŒì¼ì´ ìë™ ìƒì„±ë¨

## 4. ì‚¬ìš© ì˜ˆì‹œ

```python
import asyncio
from mcp.gmail_mcp import GmailMCP

async def main():
    config = {
        "user_id": "me",
        "credentials_file": "credentials.json",
        "token_file": "token.json"
    }
    
    gmail_mcp = GmailMCP(config)
    
    # ì—°ê²°
    await gmail_mcp.connect()
    
    # ìµœì‹  ë©”ì‹œì§€ 30ê°œ ê°€ì ¸ì˜¤ê¸°
    messages = await gmail_mcp.get_messages(max_results=30)
    
    for message in messages[:5]:
        headers = message.get('parsed_headers', {})
        print(f"From: {headers.get('from')}")
        print(f"Subject: {headers.get('subject')}")
        print(f"Snippet: {message.get('snippet')}")
        print("---")
    
    # ì—°ê²° í•´ì œ
    await gmail_mcp.disconnect()

if __name__ == "__main__":
    asyncio.run(main())
```

## 5. ì£¼ìš” ê¸°ëŠ¥

### 5.1 ì§€ì›ë˜ëŠ” ë©”ì„œë“œ
- `connect()`: Gmail API ì—°ê²°
- `get_messages(max_results=30)`: ìµœì‹  ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
- `get_profile_info()`: ê³„ì • í”„ë¡œí•„ ì •ë³´
- `get_labels()`: ë¼ë²¨ ëª©ë¡
- `search_messages(query)`: ë©”ì‹œì§€ ê²€ìƒ‰
- `disconnect()`: ì—°ê²° í•´ì œ

### 5.2 ë©”ì‹œì§€ ë°ì´í„° êµ¬ì¡°
```python
{
    "id": "ë©”ì‹œì§€ ID",
    "threadId": "ìŠ¤ë ˆë“œ ID",
    "snippet": "ë©”ì‹œì§€ ìš”ì•½",
    "parsed_headers": {
        "from": "ë°œì‹ ì",
        "subject": "ì œëª©",
        "date": "ë‚ ì§œ"
    },
    "payload": {
        "body": {
            "text": "í…ìŠ¤íŠ¸ ë³¸ë¬¸",
            "html": "HTML ë³¸ë¬¸"
        }
    }
}
```

## 6. ë¬¸ì œ í•´ê²°

### 6.1 ì¼ë°˜ì ì¸ ì˜¤ë¥˜
- **credentials.json íŒŒì¼ì´ ì—†ìŒ**: Google Cloud Consoleì—ì„œ ë‹¤ì‹œ ë‹¤ìš´ë¡œë“œ
- **ê¶Œí•œ ê±°ë¶€**: OAuth ì„¤ì •ì—ì„œ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì¶”ê°€ í•„ìš”
- **API í• ë‹¹ëŸ‰ ì´ˆê³¼**: Google Cloud Consoleì—ì„œ í• ë‹¹ëŸ‰ í™•ì¸

### 6.2 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- `credentials.json`ê³¼ `token.json` íŒŒì¼ì€ ì ˆëŒ€ë¡œ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
- `.gitignore`ì— í•´ë‹¹ íŒŒì¼ë“¤ì„ ì¶”ê°€í•˜ì„¸ìš”
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ê³„ì • ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤

## 7. ì œí•œì‚¬í•­

- Gmail APIëŠ” ì‚¬ìš©ìë‹¹ ì¼ì¼ í• ë‹¹ëŸ‰ì´ ìˆìŠµë‹ˆë‹¤ (ê¸°ë³¸: 1,000,000,000 í• ë‹¹ëŸ‰ ë‹¨ìœ„)
- ë©”ì‹œì§€ ì½ê¸°ëŠ” ì½ê¸° ì „ìš© ê¶Œí•œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤
- ëŒ€ëŸ‰ì˜ ë©”ì‹œì§€ ì²˜ë¦¬ ì‹œ API ì†ë„ ì œí•œì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤
